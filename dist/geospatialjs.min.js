var GeospatialJS;GeospatialJS=GeospatialJS||{},function(t){"use strict";t.BoundingBox=function(){var t=this;t.north=ko.observable(),t.east=ko.observable(),t.south=ko.observable(),t.west=ko.observable(),t.setFromLocations=function(e){t.north=ko.observable(-90),t.east=ko.observable(-180),t.south=ko.observable(90),t.west=ko.observable(180),e.forEach(function(e){e.lat()<t.south()&&t.south(e.lat()),e.lng()<t.west()&&t.west(e.lng()),e.lat()>t.north()&&t.north(e.lat()),e.lng()>t.east()&&t.east(e.lng())})}}}(GeospatialJS);var GeospatialJS;GeospatialJS=GeospatialJS||{},function(t){"use strict";function e(){}t.GeolocationCode=function(){var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a=function(e){var a=t.split(""),n=t.length,o="";if(n>a.length||1>=n)return!1;for(;e>=1;)o=a[e-n*Math.floor(e/n)]+o,e=Math.floor(e/n);return 11>n?parseInt(o,10):o},n=function(e){for(var a=t.split(""),n=t.length,o=e.split(""),r=0,i=1,s=o.length-1;s>=0;s--){var l=o[s];r+=a.indexOf(l)*i,i*=n}return r},o=function(t,e){return t.length<e&&(t=(new Array(e).join("0")+t).slice(-e)),t},r=function(t){var a=n(t.replace(/^GEO/,"")),o=parseInt((""+a).replace(/[_0-9]$/,""),10),r=a%10,i=(e.computeCheck(""+o)==r,Math.floor(o/1e7)/1e4-90),s=o%1e7/1e4-180;return[i,s]};return{getCode:function(t,n){var r=parseFloat(t),i=parseFloat(n);if(isNaN(r)||isNaN(i)||-90>t||t>90||-180>n||n>180)return"";var s=Math.floor(1e4*(parseFloat(t)+90)),l=Math.floor(1e4*(parseFloat(n)+180)),u=l+1e7*s,c=e.computeCheck(""+u),f=10*u+c;return"GEO"+o(a(f),8)},parseCode:r,findCodes:function(t){for(var e,a=/GEO[a-zA-Z0-9]{8}/g,n=[];e=a.exec(t);)n.push(r(e[0]));return n}}}(),e.encode=function(t){return t+this.computeCheck(t)},e.verify=function(t){for(var e=10,a=0;a<t.length-1;++a){var n=t.charCodeAt(a)-48;if(0>n||n>9)return!1;e=2*this.f(e+n)%11}return(e+this.getCheckDigit(t))%10==1},e.f=function(t){var e=t%10;return 0===e?10:e},e.computeCheck=function(t){for(var e=10,a=0;a<t.length;++a)e=2*this.f(e+t.charCodeAt(a)-48)%11;return(11-e)%10},e.getCheckDigit=function(t){return t.charCodeAt(t.length-1)-48},e.getData=function(t){return t.substring(0,t.length-1)}}(GeospatialJS);var GeospatialJS;GeospatialJS=GeospatialJS||{},function(t){"use strict";t.TrackPoint=function(t,e,a){var n=this;n.index=e,n.segment=a,n.lat=parseFloat(t.getAttribute("lat")),n.lng=parseFloat(t.getAttribute("lon")),n.getNearbyPoint=function(t){var e=n.index+t;return 0>e||e>n.segment.points.length-1?null:n.segment.points[e]},n.distance=function(t){var e=function(t){return t*Math.PI/180},a=6371,n=e(t.lat-this.lat),o=e(t.lng-this.lng),r=e(this.lat),i=e(t.lat),s=Math.sin(n/2)*Math.sin(n/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(r)*Math.cos(i),l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),u=a*l;return u},n.speed=function(){for(var t=10,e=0,a=[],o=-1;o>=-t;o--){var r=n.getNearbyPoint(o);if(!r)break;a.push(r)}if(0===a.length)return null;for(var i=n.time.unix()-a[a.length-1].time.unix(),s=0;s<a.length;s++)e+=a[s].distance(0===s?n:a[s-1]);return e/(i/3600)},n.bearing=function(){var t=n.getNearbyPoint(-1),e=n.lat,a=n.lng,o=t.lat,r=t.lng;e=e.toRad(),o=o.toRad();var i=(r-a).toRad(),s=Math.sin(i)*Math.cos(o),l=Math.cos(e)*Math.sin(o)-Math.sin(e)*Math.cos(o)*Math.cos(i);return Math.atan2(s,l).toBrng()};var o=t.getElementsByTagName("ele");o.length>0&&(n.ele=parseFloat(o[0].textContent));var r=t.getElementsByTagName("time");r.length>0&&(n.time=moment(r[0].textContent))},t.TrackSegment=function(e,a,n){var o=this,r=e.getElementsByTagName("trkpt"),i=0;o.points=_(r).map(function(e){return new t.TrackPoint(e,i++,o)}),o.index=a,o.startTime=_(o.points).min(function(t){return t.time.unix()}).time,o.endTime=_(o.points).max(function(t){return t.time.unix()}).time},t.GpxTrack=function(e){var a=this;a.getClosestPoint=function(t){var e=a.findSegmentByTimestamp(t);return e?a.getClosestPointResursive(t,e,0,e.points.length-1,0):null},a.getClosestPointResursive=function(t,e,n,o,r){if(r>10)return null;var i=n+Math.floor((o-n)/2),s=e.points[i];if(4>o-n||s.time==t){for(var l=1e9,u=n;o>=u;u++){var c=Math.abs(t-e.points[u].time);l>c&&(s=e.points[u],l=c)}return s}return s.time>t?a.getClosestPointResursive(t,e,n,i,r+1):a.getClosestPointResursive(t,e,i,o,r+1)},a.findSegmentByTimestamp=function(t){return t?_(a.segments).find(function(e){return t.unix()>=e.startTime.unix()&&t.unix()<=e.endTime.unix()}):null};var n=0;a.segments=_(e.getElementsByTagName("trkseg")).map(function(e){return new t.TrackSegment(e,n++,a)})}}(GeospatialJS);var GeospatialJS;GeospatialJS=GeospatialJS||{},function(t){"use strict";t.LatLng=function(e){var a=this;if(e instanceof Array){if(2!=e.length)throw"Array with two elements expected";if("number"!=typeof e[0]||"number"!=typeof e[1])throw"Float values expected";a.lat=ko.observable(e[0]),a.lng=ko.observable(e[1])}else if(e&&e.lat&&e.lng){if("number"!=typeof e.lat||"number"!=typeof e.lng)throw"Float values expected";a.lat=ko.observable(e.lat),a.lng=ko.observable(e.lng)}else a.lat=ko.observable(0),a.lng=ko.observable(0);a.display=function(){var e=a.lng()<0?"W":"E",n=a.lat()<0?"S":"N";return t.format("{0} {1} {2} {3}",Math.abs(t.formatNum(a.lat(),4)),n,Math.abs(t.formatNum(a.lng(),4)),e)},a.distance=function(e){var a=function(t){return t*Math.PI/180};if(!(e instanceof t.LatLng))throw"GeospatialJS.LatLng object expected";var n=6371,o=a(e.lat()-this.lat()),r=a(e.lng()-this.lng()),i=a(this.lat()),s=a(e.lat()),l=Math.sin(o/2)*Math.sin(o/2)+Math.sin(r/2)*Math.sin(r/2)*Math.cos(i)*Math.cos(s),u=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),c=n*u;return c},a.toDms=function(t){var e=parseInt(t,10),a=60*Math.abs(t-e),n=parseInt(a,10),o=60*(a-n);return[e,n,o]},a.toJS=function(){return{lat:a.lat(),lng:a.lng()}},a.toDmsFormat=function(t){var e=a.toDms(t);return GeospatialJS.format("{0}° {1}′ {2}″",Math.abs(e[0]),e[1],e[2].toFixed(2))},a.displayDms=ko.computed(function(t){var e=a.lng()<0?"W":"E",n=a.lat()<0?"S":"N";return GeospatialJS.format("{0} {1} {2} {3}",a.toDmsFormat(a.lat()),n,a.toDmsFormat(a.lng()),e)}),a.displayDec=ko.computed(function(t){return a.display()}),a.latlng=ko.computed(function(){return{lat:a.lat(),lng:a.lng()}}),a.str=function(t){return""+a.lat()+","+a.lng()},a.distanceDisplay=function(t){var e=this.distance(t);return e>=1?GeospatialJS.format("{0} {1}",GeospatialJS.formatNum(e,1),"km"):GeospatialJS.format("{0} {1}",GeospatialJS.formatNum(1e3*e),"m")},a.gridId=function(){return Math.round(1e5*(9e3+Math.floor(100*a.lat()))+18e3+Math.floor(100*a.lng()))},a.geolocatorLink=function(){return GeospatialJS.format("http://tools.freeside.sk/geolocator/geolocator.html?q={0},{1}",a.lat(),a.lng())},a.mapLink=function(t){return GeospatialJS.format("/map/{0},{1}/15/{2}",(""+a.lat()).replace(",","."),(""+a.lng()).replace(",","."),t?t:"en")},a.NS=function(){return a.lat()>=0?"N":"S"},a.EW=function(){return a.lng()>=0?"E":"W"},a.geohackLink=function(){return GeospatialJS.format("http://toolserver.org/~geohack/geohack.php?params={0}_{1}_{2}_{3}",Math.abs(a.lat()),a.NS(),Math.abs(a.lng()),a.EW())},a.geocodeLink=ko.computed(function(){return GeospatialJS.format("https://geolocation.ws/{0}",t.GeolocationCode.getCode(a.lat(),a.lng()))})}}(GeospatialJS);var GeospatialJS=GeospatialJS||{};GeospatialJS.format=function(t){var e=arguments;return t.replace(/{(\d+)}/g,function(t,a){var n=parseInt(a,10)+1;return"undefined"!=typeof e[n]?e[n]:t})},GeospatialJS.formatNum=function(t,e,a){if(!t)return null;var n={thousandSeparator:",",decimalSeparator:"."},o=$.extend({},n,a),r="";return e&&e>0&&(r=o.decimalSeparator+t.toFixed(e).slice(-e)),t.toFixed(2).slice(0,-3).replace(/(?=(?!^)(?:\d{3})+(?!\d))/g,o.thousandSeparator)+r};
//# sourceMappingURL=geospatialjs.min.js.map