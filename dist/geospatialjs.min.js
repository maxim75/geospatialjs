// GeospatialJS

var GeospatialJS;GeospatialJS=GeospatialJS||{},function(a){"use strict";a.BoundingBox=function(){var a=this;a.north=ko.observable(),a.east=ko.observable(),a.south=ko.observable(),a.west=ko.observable(),a.setFromLocations=function(b){a.north=ko.observable(-90),a.east=ko.observable(-180),a.south=ko.observable(90),a.west=ko.observable(180),b.forEach(function(b){b.lat()<a.south()&&a.south(b.lat()),b.lng()<a.west()&&a.west(b.lng()),b.lat()>a.north()&&a.north(b.lat()),b.lng()>a.east()&&a.east(b.lng())})}}}(GeospatialJS);var GeospatialJS;GeospatialJS=GeospatialJS||{},function(a){"use strict";function b(){}a.GeolocationCode=function(){var a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",c=function(b){var c=a.split(""),d=a.length,e="";if(d>c.length||1>=d)return!1;for(;b>=1;)e=c[b-d*Math.floor(b/d)]+e,b=Math.floor(b/d);return 11>d?parseInt(e,10):e},d=function(b){for(var c=a.split(""),d=a.length,e=b.split(""),f=0,g=1,h=e.length-1;h>=0;h--){var i=e[h];f+=c.indexOf(i)*g,g*=d}return f},e=function(a,b){return a.length<b&&(a=(new Array(b).join("0")+a).slice(-b)),a},f=function(a){var c=d(a.replace(/^GEO/,"")),e=parseInt((""+c).replace(/[_0-9]$/,""),10),f=c%10,g=(b.computeCheck(""+e)==f,Math.floor(e/1e7)/1e4-90),h=e%1e7/1e4-180;return[g,h]};return{getCode:function(a,d){var f=parseFloat(a),g=parseFloat(d);if(isNaN(f)||isNaN(g)||-90>a||a>90||-180>d||d>180)return"";var h=Math.floor(1e4*(parseFloat(a)+90)),i=Math.floor(1e4*(parseFloat(d)+180)),j=i+1e7*h,k=b.computeCheck(""+j),l=10*j+k;return"GEO"+e(c(l),8)},parseCode:f,findCodes:function(a){for(var b,c=/GEO[a-zA-Z0-9]{8}/g,d=[];b=c.exec(a);)d.push(f(b[0]));return d}}}(),b.encode=function(a){return a+this.computeCheck(a)},b.verify=function(a){for(var b=10,c=0;c<a.length-1;++c){var d=a.charCodeAt(c)-48;if(0>d||d>9)return!1;b=2*this.f(b+d)%11}return(b+this.getCheckDigit(a))%10==1},b.f=function(a){var b=a%10;return 0===b?10:b},b.computeCheck=function(a){for(var b=10,c=0;c<a.length;++c)b=2*this.f(b+a.charCodeAt(c)-48)%11;return(11-b)%10},b.getCheckDigit=function(a){return a.charCodeAt(a.length-1)-48},b.getData=function(a){return a.substring(0,a.length-1)}}(GeospatialJS);var GpxTracks;GpxTracks=GpxTracks||{},function(a){"use strict";a.TrackPoint=function(a,b,c){var d=this;d.index=b,d.segment=c,d.lat=parseFloat(a.getAttribute("lat")),d.lng=parseFloat(a.getAttribute("lon")),d.getNearbyPoint=function(a){var b=d.index+a;return 0>b||b>d.segment.points.length-1?null:d.segment.points[b]},d.distance=function(a){var b=function(a){return a*Math.PI/180},c=6371,d=b(a.lat-this.lat),e=b(a.lng-this.lng),f=b(this.lat),g=b(a.lat),h=Math.sin(d/2)*Math.sin(d/2)+Math.sin(e/2)*Math.sin(e/2)*Math.cos(f)*Math.cos(g),i=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),j=c*i;return j},d.speed=function(){for(var a=10,b=0,c=[],e=-1;e>=-a;e--){var f=d.getNearbyPoint(e);if(!f)break;c.push(f)}if(0===c.length)return null;for(var g=d.time.unix()-c[c.length-1].time.unix(),h=0;h<c.length;h++)b+=c[h].distance(0===h?d:c[h-1]);return b/(g/3600)},d.bearing=function(){var a=d.getNearbyPoint(-1),b=d.lat,c=d.lng,e=a.lat,f=a.lng;b=b.toRad(),e=e.toRad();var g=(f-c).toRad(),h=Math.sin(g)*Math.cos(e),i=Math.cos(b)*Math.sin(e)-Math.sin(b)*Math.cos(e)*Math.cos(g);return Math.atan2(h,i).toBrng()};var e=a.getElementsByTagName("ele");e.length>0&&(d.ele=parseFloat(e[0].textContent));var f=a.getElementsByTagName("time");f.length>0&&(d.time=moment(f[0].textContent))},a.TrackSegment=function(a,b,c){var d=this,e=a.getElementsByTagName("trkpt"),f=0;d.points=_(e).map(function(a){return new GpxTracks.TrackPoint(a,f++,d)}),d.index=b,d.startTime=_(d.points).min(function(a){return a.time.unix()}).time,d.endTime=_(d.points).max(function(a){return a.time.unix()}).time},a.GpxTrack=function(a){var b=this;b.getClosestPoint=function(a){var c=b.findSegmentByTimestamp(a);return c?b.getClosestPointResursive(a,c,0,c.points.length-1,0):null},b.getClosestPointResursive=function(a,c,d,e,f){if(f>10)return null;var g=d+Math.floor((e-d)/2),h=c.points[g];if(4>e-d||h.time==a){for(var i=1e9,j=d;e>=j;j++){var k=Math.abs(a-c.points[j].time);i>k&&(h=c.points[j],i=k)}return h}return h.time>a?b.getClosestPointResursive(a,c,d,g,f+1):b.getClosestPointResursive(a,c,g,e,f+1)},b.findSegmentByTimestamp=function(a){return a?_(b.segments).find(function(b){return a.unix()>=b.startTime.unix()&&a.unix()<=b.endTime.unix()}):null};var c=0;b.segments=_(a.getElementsByTagName("trkseg")).map(function(a){return new GpxTracks.TrackSegment(a,c++,b)})}}(GpxTracks);var GeospatialJS;GeospatialJS=GeospatialJS||{},function(a){"use strict";a.LatLng=function(b){var c=this;if(b instanceof Array){if(2!=b.length)throw"Array with two elements expected";if("number"!=typeof b[0]||"number"!=typeof b[1])throw"Float values expected";c.lat=ko.observable(b[0]),c.lng=ko.observable(b[1])}else if(b&&b.lat&&b.lng){if("number"!=typeof b.lat||"number"!=typeof b.lng)throw"Float values expected";c.lat=ko.observable(b.lat),c.lng=ko.observable(b.lng)}else c.lat=ko.observable(0),c.lng=ko.observable(0);c.display=function(){var b=c.lng()<0?"W":"E",d=c.lat()<0?"S":"N";return a.format("{0} {1} {2} {3}",Math.abs(a.formatNum(c.lat(),4)),d,Math.abs(a.formatNum(c.lng(),4)),b)},c.distance=function(b){var c=function(a){return a*Math.PI/180};if(!(b instanceof a.LatLng))throw"GeospatialJS.LatLng object expected";var d=6371,e=c(b.lat()-this.lat()),f=c(b.lng()-this.lng()),g=c(this.lat()),h=c(b.lat()),i=Math.sin(e/2)*Math.sin(e/2)+Math.sin(f/2)*Math.sin(f/2)*Math.cos(g)*Math.cos(h),j=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)),k=d*j;return k},c.toDms=function(a){var b=parseInt(a,10),c=60*Math.abs(a-b),d=parseInt(c,10),e=60*(c-d);return[b,d,e]},c.toJS=function(){return{lat:c.lat(),lng:c.lng()}},c.toDmsFormat=function(a){var b=c.toDms(a);return GeospatialJS.format("{0}° {1}′ {2}″",Math.abs(b[0]),b[1],b[2].toFixed(2))},c.displayDms=ko.computed(function(a){var b=c.lng()<0?"W":"E",d=c.lat()<0?"S":"N";return GeospatialJS.format("{0} {1} {2} {3}",c.toDmsFormat(c.lat()),d,c.toDmsFormat(c.lng()),b)}),c.displayDec=ko.computed(function(a){return c.display()}),c.latlng=ko.computed(function(){return{lat:c.lat(),lng:c.lng()}}),c.str=function(a){return""+c.lat()+","+c.lng()},c.distanceDisplay=function(a){var b=this.distance(a);return b>=1?GeospatialJS.format("{0} {1}",GeospatialJS.formatNum(b,1),"km"):GeospatialJS.format("{0} {1}",GeospatialJS.formatNum(1e3*b),"m")},c.gridId=function(){return Math.round(1e5*(9e3+Math.floor(100*c.lat()))+18e3+Math.floor(100*c.lng()))},c.geolocatorLink=function(){return GeospatialJS.format("http://tools.freeside.sk/geolocator/geolocator.html?q={0},{1}",c.lat(),c.lng())},c.mapLink=function(a){return GeospatialJS.format("/map/{0},{1}/15/{2}",(""+c.lat()).replace(",","."),(""+c.lng()).replace(",","."),a?a:"en")},c.NS=function(){return c.lat()>=0?"N":"S"},c.EW=function(){return c.lng()>=0?"E":"W"},c.geohackLink=function(){return GeospatialJS.format("http://toolserver.org/~geohack/geohack.php?params={0}_{1}_{2}_{3}",Math.abs(c.lat()),c.NS(),Math.abs(c.lng()),c.EW())},c.geocodeLink=ko.computed(function(){return GeospatialJS.format("https://geolocation.ws/{0}",a.GeolocationCode.getCode(c.lat(),c.lng()))})}}(GeospatialJS);var GeospatialJS=GeospatialJS||{};GeospatialJS.format=function(a){var b=arguments;return a.replace(/{(\d+)}/g,function(a,c){var d=parseInt(c,10)+1;return"undefined"!=typeof b[d]?b[d]:a})},GeospatialJS.formatNum=function(a,b,c){if(!a)return null;var d={thousandSeparator:",",decimalSeparator:"."},e=$.extend({},d,c),f="";return b&&b>0&&(f=e.decimalSeparator+a.toFixed(b).slice(-b)),a.toFixed(2).slice(0,-3).replace(/(?=(?!^)(?:\d{3})+(?!\d))/g,e.thousandSeparator)+f};
//# sourceMappingURL=dist/geospatialjs.min.js.map